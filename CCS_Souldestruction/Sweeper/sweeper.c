#include <usbstk5515.h>
#include <usbstk5515_i2c.h>
#include <usbstk5515_gpio.h>
#include <AIC_func.h>
#include <sar.h>
#include <stdio.h>
#include <math.h>

#define TABLE_SIZE  512
#define fs 48000.0

Int16 sinetable[TABLE_SIZE] = {
		0,  402,  804, 1206, 1608, 2009, 2410, 2811, 3212, 3612,
		4011, 4410, 4808, 5205, 5602, 5998, 6393, 6786, 7179, 7571,
		7962, 8351, 8739, 9126, 9512, 9896, 10278, 10659, 11039, 11417,
		11793, 12167, 12539, 12910, 13279, 13645, 14010, 14372, 14732,
		15090, 15446, 15800, 16151, 16499, 16846, 17189, 17530, 17869,
		18204, 18537, 18868, 19195, 19519, 19841, 20159, 20475, 20787,
		21096, 21403, 21705, 22005, 22301, 22594, 22884, 23170, 23452,
		23731, 24007, 24279, 24547, 24811, 25072, 25329, 25582, 25832,
		26077, 26319, 26556, 26790, 27019, 27245, 27466, 27683, 27896,
		28105, 28310, 28510, 28706, 28898, 29085, 29268, 29447, 29621,
		29791, 29956, 30117, 30273, 30424, 30571, 30714, 30852, 30985,
		31113, 31237, 31356, 31470, 31580, 31685, 31785, 31880, 31971,
		32057, 32137, 32213, 32285, 32351, 32412, 32469, 32521, 32567,
		32609, 32646, 32678, 32705, 32728, 32745, 32757, 32765, 32767,
		32765, 32757, 32745, 32728, 32705, 32678, 32646, 32609, 32567,
		32521, 32469, 32412, 32351, 32285, 32213, 32137, 32057, 31971,
		31880, 31785, 31685, 31580, 31470, 31356, 31237, 31113, 30985,
		30852, 30714, 30571, 30424, 30273, 30117, 29956, 29791, 29621,
		29447, 29268, 29085, 28898, 28706, 28510, 28310, 28105, 27896,
		27683, 27466, 27245, 27019, 26790, 26556, 26319, 26077, 25832,
		25582, 25329, 25072, 24811, 24547, 24279, 24007, 23731, 23452,
		23170, 22884, 22594, 22301, 22005, 21705, 21403, 21096, 20787,
		20475, 20159, 19841, 19519, 19195, 18868, 18537, 18204, 17869,
		17530, 17189, 16846, 16499, 16151, 15800, 15446, 15090, 14732,
		14372, 14010, 13645, 13279, 12910, 12539, 12167, 11793, 11417,
		11039, 10659, 10278, 9896, 9512, 9126, 8739, 8351, 7962, 7571,
		7179, 6786, 6393, 5998, 5602, 5205, 4808, 4410, 4011, 3612, 3212,
		2811, 2410, 2009, 1608, 1206,  804,  402,    0, -402, -804, -1206,
		-1608, -2009, -2410, -2811, -3212, -3612, -4011, -4410, -4808, -5205,
		-5602, -5998, -6393, -6786, -7179, -7571, -7962, -8351, -8739, -9126,
		-9512, -9896, -10278, -10659, -11039, -11417, -11793, -12167, -12539,
		-12910, -13279, -13645, -14010, -14372, -14732, -15090, -15446, -15800,
		-16151, -16499, -16846, -17189, -17530, -17869, -18204, -18537, -18868,
-19195, -19519, -19841, -20159, -20475, -20787, -21096, -21403, -21705, -22005,
-22301, -22594, -22884, -23170, -23452, -23731, -24007, -24279, -24547, -24811,
-25072, -25329, -25582, -25832, -26077, -26319, -26556, -26790, -27019, -27245,
-27466, -27683, -27896, -28105, -28310, -28510, -28706, -28898, -29085, -29268,
-29447, -29621, -29791, -29956, -30117, -30273, -30424, -30571, -30714, -30852,
-30985, -31113, -31237, -31356, -31470, -31580, -31685, -31785, -31880, -31971,
-32057, -32137, -32213, -32285, -32351, -32412, -32469, -32521, -32567, -32609,
-32646, -32678, -32705, -32728, -32745, -32757, -32765, -32767, -32765, -32757,
-32745, -32728, -32705, -32678, -32646, -32609, -32567, -32521, -32469, -32412,
-32351, -32285, -32213, -32137, -32057, -31971, -31880, -31785, -31685, -31580,
-31470, -31356, -31237, -31113, -30985, -30852, -30714, -30571, -30424, -30273,
-30117, -29956, -29791, -29621, -29447, -29268, -29085, -28898, -28706, -28510,
-28310, -28105, -27896, -27683, -27466, -27245, -27019, -26790, -26556, -26319,
-26077, -25832, -25582, -25329, -25072, -24811, -24547, -24279, -24007, -23731,
-23452, -23170, -22884, -22594, -22301, -22005, -21705, -21403, -21096, -20787,
-20475, -20159, -19841, -19519, -19195, -18868, -18537, -18204, -17869, -17530,
-17189, -16846, -16499, -16151, -15800, -15446, -15090, -14732, -14372, -14010,
-13645, -13279, -12910, -12539, -12167, -11793, -11417, -11039, -10659, -10278,
-9896, -9512, -9126, -8739, -8351, -7962, -7571, -7179, -6786, -6393, -5998, -5602,
-5205, -4808, -4410, -4011, -3612, -3212, -2811, -2410, -2009, -1608, -1206, -804, -402
};

void main(void)
{
  	USBSTK5515_init();
	USBSTK5515_I2C_init();        // Initialize I2C
  	AIC_init();
  	Init_SAR();

	Uint32 FTV, FTV_max, counter, step;
	static Int16 out, kill;
  	float min_freq, max_freq, duration;
  	printf("What MIN frequency do you want?\n");
  	scanf("%f", &min_freq);
  	printf("What MAX frequency do you want?\n");
  	scanf("%f", &max_freq);
  	printf("What DURATION do you want (in seconds)?\n");
  	scanf("%f", &duration);

  	FTV = (Uint32)(min_freq/fs*65536)<<16;		// calculate initial FTV value
  	FTV_max = (Uint32)(max_freq/fs*65536)<<16;	// calculate max FTV value

  	step = ((FTV_max-FTV))/(duration*48450);

  	counter = 0;
  	//i=0;
	//Int16 in[24230];

  	while(1)
  	{
  		FTV = FTV + step;
  		if(FTV > FTV_max) {
  			FTV = (Uint32)(min_freq/fs*65536)<<16;
  		}
  		counter = counter + FTV;
  		out = (sinetable[counter>>23]);
  		AIC_write2(out,out);
  		//AIC_read2(&right, &left);
  		//in[i]= right;
  		//i++;
  	}
}








